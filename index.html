<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¤ëŠ˜ ë­ ë¨¹ì§€? ì ì‹¬ ë£°ë ›</title>
    <!-- Tailwind CSS ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Noto Sans KR í°íŠ¸ë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš© */
        body {
            font-family: 'Noto Sans KR', 'Inter', sans-serif;
        }
        /* ë½‘ê¸° ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes pop {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .result-pop {
            animation: pop 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-md bg-white rounded-2xl shadow-xl p-6 md:p-8">
        
        <header class="text-center mb-6">
            <h1 class="text-3xl font-bold text-gray-800">ì˜¤ëŠ˜ ë­ ë¨¹ì§€? ğŸ±</h1>
            <p class="text-gray-500 mt-2">íšŒì‚¬ ì ì‹¬ ë©”ë‰´ ë£°ë ›</p>
        </header>

        <main>
            <!-- 1. êµ¬ê¸€ ì‹œíŠ¸ URL ì…ë ¥ (ë‹¤ì‹œ ë³´ì´ë„ë¡ ìˆ˜ì •) -->
            <div class="mb-4 hidden">
                <label for="sheet-url" class="block text-sm font-medium text-gray-700 mb-1">
                    Google Sheets CSV URL
                </label>
                <input type="url" id="sheet-url" placeholder="ì›¹ì— ê²Œì‹œí•œ .csv URLì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
            </div>

            <!-- 'ë©”ë‰´ ë¶ˆëŸ¬ì˜¤ê¸°' ë²„íŠ¼ (ë‹¤ì‹œ ë³´ì´ë„ë¡ ìˆ˜ì •) -->
            <button id="load-button"
                    class="w-full bg-blue-600 text-white font-bold py-2.5 px-4 rounded-lg hover:bg-blue-700 transition duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 hidden">
                ë©”ë‰´ ë¶ˆëŸ¬ì˜¤ê¸°
            </button>
            <p id="status-message" class="text-xs text-center text-gray-500 mt-2 h-4"></p>

            <!-- 2. ë©”ë‰´ ë½‘ê¸° -->
            <div class="mt-6 border-t pt-6 text-center">
                <button id="pick-button"
                        class="w-full bg-green-500 text-white text-lg font-bold py-3 px-6 rounded-lg hover:bg-green-600 transition-transform transform hover:scale-105 duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 disabled:bg-gray-300 disabled:cursor-not-allowed"
                        disabled>
                    ì˜¤ëŠ˜ì˜ ë©”ë‰´ ë½‘ê¸°! ğŸ¥³
                </button>
            </div>

            <!-- 3. ê²°ê³¼ í‘œì‹œ -->
            <div id="result-container" class="mt-6 text-center min-h-[100px] flex flex-col items-center justify-center">
                <!-- ë£°ë › í…ìŠ¤íŠ¸ -->
                <p id="result-text" class="text-4xl font-extrabold text-blue-600"></p>
                
                <!-- ìƒì„¸ ì •ë³´ (ìˆ¨ê²¨ì ¸ ìˆë‹¤ê°€ ë½‘ê¸° ì™„ë£Œ í›„ í‘œì‹œ) -->
                <div id="result-details" class="hidden w-full mt-6 space-y-4">
                    
                    <!-- ê°€ëŠ” ê¸¸/ìœ„ì¹˜ (ì´ë¯¸ì§€ë¡œ ë³€ê²½) -->
                    <div id="location-info" class="hidden">
                        <p class="text-sm font-medium text-gray-500 mb-1">ìœ„ì¹˜/ê°€ëŠ” ê¸¸</p>
                        <img id="location-image" src="https://placehold.co/600x400/e2e8f0/94a3b8?text=Location" alt="ìœ„ì¹˜/ê°€ëŠ” ê¸¸ ì´ë¯¸ì§€" class="w-full h-auto rounded-lg shadow-md aspect-video object-cover" 
                             onerror="this.src='https://placehold.co/600x400/e2e8f0/94a3b8?text=Location'; this.alt='ìœ„ì¹˜/ê°€ëŠ” ê¸¸ ì´ë¯¸ì§€ ì—†ìŒ';">
                    </div>
                    
                    <!-- ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ (ë©”ë‰´íŒ, ìŒì‹) -->
                    <div class="grid grid-cols-2 gap-4 mt-4">
                        <div>
                            <p class="text-sm font-medium text-gray-500 mb-1">ë©”ë‰´íŒ</p>
                            <img id="menu-image" src="https://placehold.co/300x300/e2e8f0/94a3b8?text=Menu" alt="ë©”ë‰´íŒ ì´ë¯¸ì§€" class="w-full h-auto rounded-lg shadow-md aspect-square object-cover" 
                                 onerror="this.src='https://placehold.co/300x300/e2e8f0/94a3b8?text=Menu'; this.alt='ë©”ë‰´íŒ ì´ë¯¸ì§€ ì—†ìŒ';">
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-500 mb-1">í›„ê¸°/ìŒì‹ ì‚¬ì§„</p>
                            <img id="food-image" src="https://placehold.co/300x300/e2e8f0/94a3b8?text=Food" alt="ìŒì‹ ì‚¬ì§„" class="w-full h-auto rounded-lg shadow-md aspect-square object-cover"
                                 onerror="this.src='https://placehold.co/300x300/e2e8f0/94a3b8?text=Food'; this.alt='ìŒì‹ ì‚¬ì§„ ì—†ìŒ';">
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- ì‚¬ìš© ë°©ë²• ì•ˆë‚´ (Bì—´ ë‚´ìš© ìˆ˜ì •) -->
        <footer class="mt-6 border-t pt-4">
            <details class="text-gray-600">
                <summary class="cursor-pointer text-sm font-medium hover:text-gray-800">
                    â„¹ï¸ Google Sheets ì„¤ì • ë°©ë²•
                </summary>
                <div class="mt-2 p-3 bg-gray-50 rounded-lg text-xs space-y-1">
                    <p class="font-bold">ë°˜ë“œì‹œ ì—´ ìˆœì„œë¥¼ ì§€ì¼œì£¼ì„¸ìš”:</p>
                    <p>âˆ™ <span class="font-semibold">Aì—´:</span> ì‹ë‹¹/ë©”ë‰´ ì´ë¦„ (í•„ìˆ˜)</p>
                    <p>âˆ™ <span class="font-semibold">Bì—´:</span> ê°€ëŠ” ê¸¸/ìœ„ì¹˜ <span class="text-red-600 font-bold">ì‚¬ì§„ (URL)</span></p>
                    <p>âˆ™ <span class="font-semibold">Cì—´:</span> ë©”ë‰´íŒ ì‚¬ì§„ (URL)</p>
                    <p>âˆ™ <span class="font-semibold">Dì—´:</span> ìŒì‹ ì‚¬ì§„ (URL)</p>
                    <p class="mt-2">1. Google Sheetsì—ì„œ ìœ„ ìˆœì„œëŒ€ë¡œ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.</p>
                    <p>2. <span class="font-semibold text-red-600">ì£¼ì˜:</span> ëª¨ë“  ì´ë¯¸ì§€ëŠ” ì§ì ‘ ë„£ì§€ ë§ê³ , ì´ë¯¸ì§€ì˜ 'URL ì£¼ì†Œ'ë¥¼ B, C, Dì—´ì— í…ìŠ¤íŠ¸ë¡œ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.</p>
                    <p>3. [íŒŒì¼] > [ê³µìœ ] > [ì›¹ì— ê²Œì‹œ]ë¡œ ì´ë™í•˜ì„¸ìš”.</p>
                    <p>4. 'ë§í¬' íƒ­ì—ì„œ ì‹œíŠ¸ë¥¼ ì„ íƒí•˜ê³ , í˜•ì‹ì„ '.csv'ë¡œ ë³€ê²½í•˜ì„¸ìš”.</p>
                    <p>5. [ê²Œì‹œ]ë¥¼ ëˆ„ë¥´ê³  ìƒì„±ëœ URLì„ ë³µì‚¬í•´ ìœ„ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.</p>
                </div>
            </details>
        </footer>

    </div>

    <script>
        const sheetUrlInput = document.getElementById('sheet-url');
        const loadButton = document.getElementById('load-button');
        const pickButton = document.getElementById('pick-button');
        const resultText = document.getElementById('result-text');
        const statusMessage = document.getElementById('status-message');
        
        // ìƒì„¸ ì •ë³´ DOM ìš”ì†Œ
        const detailsContainer = document.getElementById('result-details');
        const locationInfoDiv = document.getElementById('location-info');
        const locationImage = document.getElementById('location-image'); // 'ê°€ëŠ” ê¸¸' ì´ë¯¸ì§€ íƒœê·¸
        const menuImage = document.getElementById('menu-image');
        const foodImage = document.getElementById('food-image');


        let menuList = [];

        // ë¡œì»¬ ì €ì¥ì†Œì—ì„œ URL ë¶ˆëŸ¬ì˜¤ê¸° (í•˜ë“œì½”ë”© ì œê±°, localStorage ì‚¬ìš©ìœ¼ë¡œ ë³µì›)
        (function loadUrlFromStorage() {
            // ì‚¬ìš©ìê°€ ì œê³µí•œ URLì„ input ê°’ìœ¼ë¡œ ì§ì ‘ ì„¤ì •
            const savedUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSHqg-V9dLAbA_a30oHi1d7fF6UdyuDnIDu7yrJfC9kXuJnu2ow0ZeuSkdkGeZ1reVi878U27s4Hll3/pub?output=csv';
            if (savedUrl) {
                sheetUrlInput.value = savedUrl;
                loadMenus(); // URLì´ ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¤ê¸°
            }
        })();
        
        // ë©”ë‰´ ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜
        async function loadMenus() {
            const url = sheetUrlInput.value.trim();
            if (!url) {
                showStatus('URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            // êµ¬ê¸€ ì‹œíŠ¸ CSV URLì´ ë§ëŠ”ì§€ ê°„ë‹¨íˆ í™•ì¸
            if (!url.startsWith('https://docs.google.com/spreadsheets/d/e/') || !url.endsWith('output=csv')) {
                 showStatus('ìœ íš¨í•œ Google Sheets .csv ê²Œì‹œ URLì´ ì•„ë‹™ë‹ˆë‹¤.', 'error');
                 return;
            }

            showStatus('ë©”ë‰´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', 'loading');
            
            try {
                // Google Sheets CSVëŠ” ìºì‹œ ë¬¸ì œê°€ ìˆì„ ìˆ˜ ìˆì–´, íƒ€ì„ìŠ¤íƒ¬í”„ë¥¼ ì¶”ê°€í•´ ê°•ì œë¡œ ìƒˆë¡œê³ ì¹¨
                const res = await fetch(`${url}&t=${new Date().getTime()}`);
                
                if (!res.ok) {
                    throw new Error(`ë„¤íŠ¸ì›Œí¬ ì‘ë‹µ ì˜¤ë¥˜: ${res.statusText}`);
                }

                const csvText = await res.text();
                
                // CSV íŒŒì‹±: ê° ì¤„ì„ ë©”ë‰´ ê°ì²´ë¡œ ì·¨ê¸‰
                menuList = csvText
                    .split('\n')
                    .map(row => {
                        // CSVëŠ” ì‰¼í‘œë¡œ ì—´ì„ êµ¬ë¶„í•©ë‹ˆë‹¤.
                        // ë”°ì˜´í‘œë¡œ ë¬¶ì¸ ì‰¼í‘œë¥¼ ë¬´ì‹œí•˜ëŠ” ê°„ë‹¨í•œ CSV íŒŒì„œ
                        const columns = [];
                        let inQuote = false;
                        let currentColumn = '';
                        for (let i = 0; i < row.length; i++) {
                            const char = row[i];
                            
                            if (char === '"' && (i === 0 || row[i-1] !== '\\')) {
                                inQuote = !inQuote;
                            } else if (char === ',' && !inQuote) {
                                columns.push(currentColumn.trim().replace(/^"|"$/g, '')); // ì•ë’¤ ë”°ì˜´í‘œ ì œê±°
                                currentColumn = '';
                            } else {
                                currentColumn += char;
                            }
                        }
                        columns.push(currentColumn.trim().replace(/^"|"$/g, '')); // ë§ˆì§€ë§‰ ì—´ ì¶”ê°€

                        
                        const name = columns[0] ? columns[0].trim() : null;
                        if (!name) return null; // Aì—´(ì´ë¦„)ì´ ì—†ìœ¼ë©´ ê·¸ ì¤„ì€ ë¬´ì‹œ

                        return {
                            name: name,
                            locationImg: columns[1] ? columns[1].trim() : null, // Bì—´: ìœ„ì¹˜ ì´ë¯¸ì§€ URL
                            menuImg: columns[2] ? columns[2].trim() : null,  // Cì—´: ë©”ë‰´íŒ URL
                            foodImg: columns[3] ? columns[3].trim() : null   // Dì—´: ìŒì‹ URL
                        };
                    })
                    .filter(item => item !== null && item.name.length > 0); // ìœ íš¨í•œ í•­ëª©ë§Œ í•„í„°ë§

                if (menuList.length === 0) {
                    showStatus('ë©”ë‰´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‹œíŠ¸ Aì—´ì— ë©”ë‰´ê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.', 'error');
                    pickButton.disabled = true;
                } else {
                    showStatus(`${menuList.length}ê°œì˜ ë©”ë‰´ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!`, 'success');
                    pickButton.disabled = false;
                    // URLì„ ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥ (ë³µì›)
                    // localStorage.setItem('lunchRouletteSheetUrl', url); // URLì´ í•˜ë“œì½”ë”©ë˜ì—ˆìœ¼ë¯€ë¡œ ì €ì¥í•  í•„ìš” ì—†ìŒ
                }
                
            } catch (error) {
                console.error('ë©”ë‰´ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
                showStatus('ë©”ë‰´ ë¶ˆëŸ¬ì˜¤ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. URLì„ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
                pickButton.disabled = true;
            }
        }

        // ë©”ë‰´ ë½‘ê¸° í•¨ìˆ˜
        function pickMenu() {
            if (menuList.length === 0) {
                showStatus('ë¨¼ì € ë©”ë‰´ë¥¼ ë¶ˆëŸ¬ì™€ì£¼ì„¸ìš”.', 'error');
                return;
            }

            // ë½‘ê¸° ì‹œì‘ ì‹œ, ì´ì „ ìƒì„¸ ì •ë³´ ìˆ¨ê¸°ê¸°
            detailsContainer.classList.add('hidden');
            
            // ê²°ê³¼ í…ìŠ¤íŠ¸ ì´ˆê¸°í™” (ì• ë‹ˆë©”ì´ì…˜ ì¬ì‹¤í–‰ì„ ìœ„í•´)
            resultText.classList.remove('result-pop');
            void resultText.offsetWidth; // ë¦¬í”Œë¡œìš° ê°•ì œ

            // ë©”ë‰´ ë½‘ê¸° ë¡œì§
            const randomIndex = Math.floor(Math.random() * menuList.length);
            const pickedItem = menuList[randomIndex]; // ì´ì œ ë¬¸ìì—´ì´ ì•„ë‹Œ ê°ì²´ì…ë‹ˆë‹¤.

            // ë£°ë › íš¨ê³¼ (ì—¬ëŸ¬ ë©”ë‰´ë¥¼ ë¹ ë¥´ê²Œ ë³´ì—¬ì¤Œ)
            let intervalCount = 0;
            const maxIntervals = 15 + Math.floor(Math.random() * 10); // 15~25íšŒ ëœë¤
            const interval = setInterval(() => {
                const randomItem = menuList[Math.floor(Math.random() * menuList.length)];
                resultText.textContent = randomItem.name; // ê°ì²´ì˜ 'name' ì†ì„±ì„ í‘œì‹œ
                resultText.classList.remove('text-blue-600');
                resultText.classList.add('text-gray-400'); // ë£°ë › ì¤‘ì—ëŠ” íšŒìƒ‰ìœ¼ë¡œ
                
                intervalCount++;

                if (intervalCount > maxIntervals) {
                    clearInterval(interval);
                    // ìµœì¢… ê²°ê³¼ í‘œì‹œ
                    resultText.textContent = pickedItem.name; // ìµœì¢… ì´ë¦„ í‘œì‹œ
                    resultText.classList.remove('text-gray-400');
                    resultText.classList.add('text-blue-600'); // ìµœì¢… ê²°ê³¼ëŠ” íŒŒë€ìƒ‰ìœ¼ë¡œ
                    resultText.classList.add('result-pop'); // ì• ë‹ˆë©”ì´ì…˜ ì ìš©

                    // â˜… ìƒì„¸ ì •ë³´ í‘œì‹œ í•¨ìˆ˜ í˜¸ì¶œ â˜…
                    updateResultDetails(pickedItem);
                }
            }, 80); // 80ms ë§ˆë‹¤ ë©”ë‰´ ë³€ê²½
        }

        // â˜… [ìˆ˜ì •] ë½‘íŒ ë©”ë‰´ì˜ ìƒì„¸ ì •ë³´ë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
        function updateResultDetails(item) {
            
            // 1. ìœ„ì¹˜ ì´ë¯¸ì§€ (Bì—´)
            if (item.locationImg && item.locationImg.length > 0) {
                locationImage.src = item.locationImg;
                locationInfoDiv.classList.remove('hidden');
            } else {
                locationInfoDiv.classList.add('hidden');
                locationImage.src = 'https://placehold.co/600x400/e2e8f0/94a3b8?text=Location'; // ë¦¬ì…‹
            }

            // 2. ë©”ë‰´íŒ ì´ë¯¸ì§€ (Cì—´)
            menuImage.src = item.menuImg || 'https://placehold.co/300x300/e2e8f0/94a3b8?text=Menu';

            // 3. ìŒì‹ ì‚¬ì§„ (Dì—´)
            foodImage.src = item.foodImg || 'https://placehold.co/300x300/e2e8f0/94a3b8?text=Food';

            // ìƒì„¸ ì •ë³´ ì»¨í…Œì´ë„ˆ í‘œì‹œ
            detailsContainer.classList.remove('hidden');
        }

        // ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.classList.remove('text-green-600', 'text-red-600', 'text-gray-500');

            if (type === 'success') {
                statusMessage.classList.add('text-green-600');
            } else if (type === 'error') {
                statusMessage.classList.add('text-red-600');
            } else {
                statusMessage.classList.add('text-gray-500');
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
        loadButton.addEventListener('click', loadMenus);
        pickButton.addEventListener('click', pickMenu);
    </script>
</body>
</html>


