<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오늘 뭐 먹지? 점심 룰렛</title>
    <!-- Tailwind CSS 로드 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Noto Sans KR 폰트를 기본으로 사용 */
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        /* 룰렛 애니메이션을 위한 키프레임 */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(3600deg); } /* 10바퀴 */
        }
        .spinning {
            animation: spin 3s cubic-bezier(0.25, 0.1, 0.25, 1) forwards;
        }
        /* 결과 팝업 애니메이션 */
        @keyframes pop {
            0% { transform: scale(0.8); opacity: 0; }
            80% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .result-pop {
            animation: pop 0.5s ease-out forwards;
        }
        /* Clickable images */
        .clickable-img {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .clickable-img:hover {
            transform: scale(1.03);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        /* Shake animation for review input error */
        @keyframes shake {
            10%, 90% { transform: translateX(-1px); }
            20%, 80% { transform: translateX(2px); }
            30%, 50%, 70% { transform: translateX(-4px); }
            40%, 60% { transform: translateX(4px); }
        }
        .animate-shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white w-full max-w-xl rounded-2xl shadow-xl p-6 md:p-8">
        
        <!-- 헤더 -->
        <header class="text-center mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-indigo-600">오늘 뭐 먹지? 😋</h1>
            <p class="text-gray-500 mt-2">버튼을 눌러 점심 메뉴를 뽑아보세요!</p>
        </header>

        <!-- URL 입력창 (현재 하드코딩으로 숨김) -->
        <div class="mb-4 hidden">
            <label for="sheet-url" class="block text-sm font-medium text-gray-700 mb-1">Google Sheets CSV URL</label>
            <input type="text" id="sheet-url" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                   placeholder="Google Sheets '웹에 게시' .csv URL을 붙여넣으세요.">
        </div>
        <button id="load-button" class="w-full bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all mb-4 hidden">
            메뉴 불러오기
        </button>

        <!-- 룰렛 결과 표시 -->
        <div id="result-display" class="w-full h-48 bg-gray-100 rounded-lg flex items-center justify-center text-center p-4 mb-6 shadow-inner overflow-hidden">
            <span id="result-text" class="text-3xl font-bold text-gray-700 transition-all duration-300">
                무엇을 먹을까요?
            </span>
        </div>

        <!-- 뽑기 버튼 -->
        <button id="pick-button" class="w-full bg-indigo-600 text-white text-2xl font-bold py-4 px-6 rounded-lg shadow-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all transform hover:scale-105 disabled:bg-gray-400 disabled:shadow-none disabled:transform-none"
                disabled>
            오늘의 메뉴 뽑기! 🥳
        </button>
        <p id="loading-text" class="text-center text-gray-500 mt-2 hidden">
            메뉴를 불러오는 중입니다...
        </p>
        <p id="error-text" class="text-center text-red-500 mt-2 hidden"></p>
        
        <!-- 뽑힌 메뉴 상세 정보 (숨겨져 있음) -->
        <div id="result-details" class="mt-6 border-t pt-6 hidden">
            <!-- 이미지 갤러리 -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- 가는 길/위치 (이미지로 변경) -->
                <div id="location-info" class="hidden">
                    <p class="text-sm font-medium text-gray-500 mb-1">위치/가는 길</p>
                    <img id="location-image" src="https://placehold.co/600x400/e2e8f0/94a3b8?text=Location" alt="위치/가는 길 이미지" class="w-full h-auto rounded-lg shadow-md aspect-video object-cover clickable-img" 
                         onerror="this.src='https://placehold.co/600x400/e2e8f0/94a3b8?text=Location'; this.alt='위치/가는 길 이미지 없음';">
                </div>
                
                <!-- 메뉴판 -->
                <div>
                    <p class="text-sm font-medium text-gray-500 mb-1">메뉴판</p>
                    <img id="menu-image" src="https://placehold.co/300x300/e2e8f0/94a3b8?text=Menu" alt="메뉴판 이미지" class="w-full h-auto rounded-lg shadow-md aspect-square object-cover clickable-img" 
                         onerror="this.src='https://placehold.co/300x300/e2e8f0/94a3b8?text=Menu'; this.alt='메뉴판 이미지 없음';">
                </div>
                <!-- 음식 사진 -->
                <div>
                    <p class="text-sm font-medium text-gray-500 mb-1">후기/음식 사진</p>
                    <img id="food-image" src="https://placehold.co/300x300/e2e8f0/94a3b8?text=Food" alt="음식 사진" class="w-full h-auto rounded-lg shadow-md aspect-square object-cover clickable-img"
                         onerror="this.src='https://placehold.co/300x300/e2e8f0/94a3b8?text=Food'; this.alt='음식 사진 없음';">
                </div>
            </div>

            <!-- Review Section (hidden by default) -->
            <div id="review-section" class="mt-6 hidden">
                <h3 class="text-xl font-bold text-gray-800 mb-3">💬 이 메뉴 리뷰</h3>
                <!-- Review Form -->
                <div class="flex gap-2 mb-4">
                    <input type="text" id="review-input" class="flex-grow w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="한 줄 리뷰를 남겨주세요...">
                    <button id="submit-review-button" class="flex-shrink-0 bg-indigo-600 text-white font-semibold px-4 py-2 rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all">
                        등록
                    </button>
                </div>
                <!-- Review List -->
                <div id="review-list" class="space-y-3 max-h-48 overflow-y-auto bg-gray-50 p-3 rounded-lg">
                    <!-- Reviews will be populated here -->
                    <p id="review-placeholder" class="text-gray-500 italic text-center">리뷰를 불러오는 중...</p>
                </div>
            </div>

        </div>

        <!-- 하단 푸터 (설명서) -->
        <footer class="mt-8 text-center">
            <details class="text-sm text-gray-500 cursor-pointer">
                <summary>사용 방법 (클릭하여 열기)</summary>
                <div class="mt-2 text-left p-4 bg-gray-50 rounded-lg">
                    <p>이 프로그램은 Google Sheets와 연동됩니다.</p>
                    <p class="font-bold mt-2">시트 구조 (총 4열):</p>
                    <ul class="list-disc list-inside">
                        <li>A열: 식당/메뉴 이름 (필수)</li>
                        <li>B열: 가는 길/위치 (이미지 URL)</li>
<li>C열: 메뉴판 (이미지 URL)</li>
                        <li>D열: 음식/후기 사진 (이미지 URL)</li>
                    </ul>
                </div>
            </details>
        </footer>

    </div>

    <!-- Image Modal Lightbox -->
    <div id="image-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center p-4 z-50 hidden transition-opacity duration-300"
         style="backdrop-filter: blur(5px);">
        <div class="relative max-w-3xl max-h-full">
            <img id="modal-image-content" src="" alt="확대 이미지" class="max-w-full max-h-[90vh] rounded-lg shadow-xl">
            <!-- 닫기 버튼 -->
            <button id="modal-close" 
                    class="absolute -top-3 -right-3 bg-white text-gray-700 rounded-full w-10 h-10 flex items-center justify-center text-2xl font-bold shadow-lg transition-transform transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-white">
                &times;
            </button>
        </div>
    </div>


    <!-- Firebase SDKs (v12.4.0) -->
    <script type="module">
        // Firebase SDKs - v12.4.0
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            onSnapshot, 
            query, 
            orderBy, 
            serverTimestamp,
            setLogLevel // for debugging
        } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

        // DOM 요소 가져오기
        const sheetUrlInput = document.getElementById('sheet-url');
        const loadButton = document.getElementById('load-button');
        const pickButton = document.getElementById('pick-button');
        const resultText = document.getElementById('result-text');
        const loadingText = document.getElementById('loading-text');
        const errorText = document.getElementById('error-text');
        const resultDetails = document.getElementById('result-details');
        const locationInfo = document.getElementById('location-info');
        const locationImage = document.getElementById('location-image');
        const menuImage = document.getElementById('menu-image');
        const foodImage = document.getElementById('food-image');
        
        // Modal elements
        const imageModal = document.getElementById('image-modal');
        const modalImageContent = document.getElementById('modal-image-content');
        const modalClose = document.getElementById('modal-close');

        // Review elements
        const reviewSection = document.getElementById('review-section');
        const reviewInput = document.getElementById('review-input');
        const submitReviewButton = document.getElementById('submit-review-button');
        const reviewList = document.getElementById('review-list');
        const reviewPlaceholder = document.getElementById('review-placeholder');

        // 전역 변수
        let menuList = [];
        let isSpinning = false;

        // Firebase and Review variables
        let db, auth, appId, userId;
        let currentPickedItem = null;
        let currentReviewUnsubscribe = null; // 현재 구독중인 리뷰 리스너

        // --- Firebase 초기화 및 인증 (GitHub Pages용) ---
        async function initializeFirebase() {
            try {
                // [중요!] 여기에 1단계에서 복사한 firebaseConfig 객체를 붙여넣으세요.
                // 이것은 사용자님 고유의 '열쇠'입니다.
                const firebaseConfig = {
                    apiKey: "AIzaSyBDyz1Ti1Oo8K44JHogdLKdGIQILTp2sgI",
                    authDomain: "my-lunch-roulette.firebaseapp.com",
                    projectId: "my-lunch-roulette",
                    storageBucket: "my-lunch-roulette.firebasestorage.app",
                    messagingSenderId: "72237589697",
                    appId: "1:72237589697:web:e2d66bd1a96da08d432040",
                    measurementId: "G-T6GEZC0GG8"
                };

                // [중요!] Firestore 데이터 경로를 위한 고유 앱 ID
                // (Firebase 프로젝트 ID와 달라도 됩니다. 우리 앱끼리 데이터를 구분하는 용도)
                const appIdString = "my-lunch-roulette-app"; // 이 값을 사용합니다.


                if (!firebaseConfig.apiKey) {
                    console.error("Firebase config is missing.");
                    errorText.textContent = "리뷰 기능을 초기화할 수 없습니다. (Config 누락)";
                    errorText.classList.remove('hidden');
                    return;
                }
                
                appId = appIdString; // 전역 변수에 할당

                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                setLogLevel('Debug'); // 디버그 로그 활성화

                // [FIXED] 익명 로그인 및 userId 할당 타이밍 문제 수정
                // GitHub Pages에서는 항상 익명 로그인 사용
                console.log("Attempting anonymous sign-in...");
                const userCredential = await signInAnonymously(auth);
                userId = userCredential.user.uid; // 로그인 성공 직후 userId를 확실하게 할당
                
                console.log("Firebase initialized for GitHub Pages. User ID:", userId);
                
            } catch (err) {
                console.error("Firebase init error:", err);
                errorText.textContent = `리뷰 기능 오류: ${err.message}`;
                errorText.classList.remove('hidden');
            }
        }

        // --- 메뉴 불러오기 함수 ---
        async function loadMenus() {
            const url = sheetUrlInput.value;
            if (!url) {
                errorText.textContent = 'Google Sheets URL을 입력하세요.';
                errorText.classList.remove('hidden');
                return;
            }

            loadingText.classList.remove('hidden');
            errorText.classList.add('hidden');
            pickButton.disabled = true;

            try {
                // 캐시 방지를 위해 타임스탬프 추가
                const fetchUrl = `${url}&_t=${new Date().getTime()}`;
                const response = await fetch(fetchUrl);
                if (!response.ok) {
                    throw new Error('네트워크 응답이 올바르지 않습니다.');
                }
                const csvText = await response.text();
                
                menuList = csvText.split('\n')
                    .map(row => row.trim())
                    .filter(row => row.length > 0)
                    .map(row => {
                        // CSV 파싱 개선: 쉼표가 포함된 문자열 처리 (기본적인 형태)
                        // "이름,A",B,C,D -> ["이름,A", B, C, D]
                        // "따옴표"로 묶인 필드 내의 쉼표는 무시하는 간단한 파서
                        const parts = [];
                        let currentPart = '';
                        let inQuote = false;
                        for (let i = 0; i < row.length; i++) {
                            const char = row[i];
                            if (char === '"') {
                                inQuote = !inQuote;
                            } else if (char === ',' && !inQuote) {
                                parts.push(currentPart.trim().replace(/^"|"$/g, '')); // 앞뒤 따옴표 제거
                                currentPart = '';
                            } else {
                                currentPart += char;
                            }
                        }
                        parts.push(currentPart.trim().replace(/^"|"$/g, '')); // 마지막 부분 추가

                        return {
                            name: parts[0] || '이름 없음',
                            locationImg: parts[1] || '', // B열: 가는 길 이미지
                            menuImg: parts[2] || '',     // C열: 메뉴판 이미지
                            foodImg: parts[3] || ''      // D열: 음식 이미지
                        };
                    })
                    .filter(item => item.name !== '이름 없음' && item.name.length > 0 && item.name !== '식당/메뉴 이름'); // 헤더(A1) 행 제외

                if (menuList.length === 0) {
                    throw new Error('시트에서 메뉴를 찾을 수 없거나 A열이 비어있습니다. (A1 헤더 제외 1개 이상 필요)');
                }
                
                pickButton.disabled = false;
                resultText.textContent = "메뉴 준비 완료!";

            } catch (error) {
                console.error('Error loading menus:', error);
                errorText.textContent = `메뉴 로드 실패: ${error.message}`;
                errorText.classList.remove('hidden');
            } finally {
                loadingText.classList.add('hidden');
            }
        }

        // --- 메뉴 뽑기 함수 ---
        function pickMenu() {
            if (isSpinning || menuList.length === 0) return;

            isSpinning = true;
            pickButton.disabled = true;
            resultDetails.classList.add('hidden'); // 이전 결과 숨기기
            reviewSection.classList.add('hidden'); // 이전 리뷰 숨기기
            errorText.classList.add('hidden'); // 이전 오류 숨기기

            // 룰렛 애니메이션
            resultText.classList.add('spinning');
            resultText.style.transform = 'scale(0.8)';
            
            let spinCount = 0;
            const spinInterval = setInterval(() => {
                spinCount++;
                const randomItem = menuList[Math.floor(Math.random() * menuList.length)];
                resultText.textContent = randomItem.name;
                
                // 스핀 시간을 1.5초 ~ 2.5초 사이로 랜덤하게 조절
                const randomSpinDuration = Math.random() * 10 + 15; // 15 ~ 25회 (1.5초 ~ 2.5초)
                
                if (spinCount > randomSpinDuration) {
                    clearInterval(spinInterval);
                    
                    // 최종 메뉴 선택
                    const pickedItem = menuList[Math.floor(Math.random() * menuList.length)];
                    currentPickedItem = pickedItem; // 현재 뽑힌 메뉴 저장

                    resultText.textContent = pickedItem.name;
                    resultText.classList.remove('spinning');
                    resultText.classList.add('result-pop');
                    resultText.style.transform = 'scale(1)';

                    // 애니메이션 끝난 후 상세 정보 표시
                    setTimeout(() => {
                        updateResultDetails(pickedItem);
                        resultText.classList.remove('result-pop');
                        isSpinning = false;
                        pickButton.disabled = false;
                        
                        // 리뷰 로드
                        if(db && userId) { // Firestore와 userId가 모두 준비되었을 때만
                            loadReviews(pickedItem.name);
                        } else {
                            console.warn("DB or UserID not ready, cannot load reviews.");
                            if (!db) errorText.textContent = "리뷰 DB에 연결되지 않았습니다.";
                            if (!userId) errorText.textContent = "리뷰 사용자 인증에 실패했습니다.";
                            errorText.classList.remove('hidden');
                        }
                    }, 500); // pop 애니메이션 시간
                }
            }, 100); // 100ms 마다 이름 변경
        }

        // --- 결과 상세 정보 업데이트 ---
        function updateResultDetails(item) {
            // B열: 가는 길 이미지
            if (item.locationImg && item.locationImg.startsWith('http')) {
                locationImage.src = item.locationImg;
                locationInfo.classList.remove('hidden');
            } else {
                locationInfo.classList.add('hidden');
            }
            // C열: 메뉴판 이미지
            menuImage.src = (item.menuImg && item.menuImg.startsWith('http')) ? item.menuImg : 'https://placehold.co/300x300/e2e8f0/94a3b8?text=Menu';
            // D열: 음식 이미지
            foodImage.src = (item.foodImg && item.foodImg.startsWith('http')) ? item.foodImg : 'https://placehold.co/300x300/e2e8f0/94a3b8?text=Food';

            resultDetails.classList.remove('hidden');
        }

        // --- 리뷰 불러오기 (Firestore onSnapshot) ---
        function loadReviews(restaurantName) {
            if (!db || !appId) {
                console.error("Firestore DB or AppID is not initialized.");
                return;
            }

            // 기존에 구독중인 리스너가 있다면 해제 (다른 메뉴를 뽑았을 경우)
            if (currentReviewUnsubscribe) {
                currentReviewUnsubscribe();
            }

            reviewSection.classList.remove('hidden');
            reviewList.innerHTML = ''; // 기존 목록 비우기
            reviewPlaceholder.textContent = '리뷰를 불러오는 중...';
            reviewPlaceholder.classList.remove('hidden');
            errorText.classList.add('hidden'); // 리뷰 로드 시작 시 오류 숨기기

            // Firestore 경로 생성 (메뉴 이름에 특수문자(./)가 있으면 경로로 인식되므로 치환)
            const safeRestaurantName = restaurantName.replace(/[.\/]/g, '_'); // . 이나 / 를 _로 변경
            const collectionPath = `artifacts/${appId}/public/data/lunch-reviews/${safeRestaurantName}/reviews`;
            const reviewsCollection = collection(db, collectionPath);
            
            // 타임스탬프 기준으로 내림차순 정렬 쿼리 (최신순)
            const q = query(reviewsCollection, orderBy("timestamp", "desc"));

            console.log(`Listening for reviews at: ${collectionPath}`);

            // 실시간 리스너 구독
            currentReviewUnsubscribe = onSnapshot(q, (snapshot) => {
                reviewList.innerHTML = ''; // 목록 다시 비우기
                if (snapshot.empty) {
                    reviewPlaceholder.textContent = '아직 리뷰가 없습니다. 첫 리뷰를 남겨주세요!';
                    reviewPlaceholder.classList.remove('hidden');
                } else {
                    reviewPlaceholder.classList.add('hidden');
                    snapshot.forEach((doc) => {
                        const review = doc.data();
                        const reviewEl = document.createElement('div');
                        reviewEl.className = 'bg-white p-3 rounded-md shadow-sm border border-gray-200';
                        
                        const textEl = document.createElement('p');
                        textEl.textContent = review.text;
                        textEl.className = 'text-gray-800 break-words'; // 긴 단어 줄바꿈
                        reviewEl.appendChild(textEl);

                        if (review.timestamp) {
                            const dateEl = document.createElement('p');
                            dateEl.textContent = new Date(review.timestamp.seconds * 1000).toLocaleString('ko-KR', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                            dateEl.className = 'text-xs text-gray-400 mt-1 text-right';
                            reviewEl.appendChild(dateEl);
                        }
                        reviewList.appendChild(reviewEl);
                    });
                }
            }, (error) => {
                console.error("Error fetching reviews: ", error);
                // Firestore 색인 오류 감지
                if (error.code === 'failed-precondition') {
                     reviewPlaceholder.textContent = '리뷰 로딩 오류 (색인 필요). 콘솔을 확인하세요.';
                     console.error("FIRESTORE ERROR: ", error.message);
                     console.log("Firestore 색인 자동 생성 링크 (위 메시지의 URL을 클릭하세요):");
                } else {
                    reviewPlaceholder.textContent = '리뷰를 불러오는 중 오류가 발생했습니다.';
                }
                reviewPlaceholder.classList.remove('hidden');
            });
        }

        // --- 리뷰 제출 함수 (Firestore addDoc) ---
        async function submitReview() {
            // [FIXED] userId가 확실히 있는지 다시 한번 확인
            if (!db || !appId || !currentPickedItem || !userId) {
                console.error("Review submission failed. Missing critical data.", { db, appId, currentPickedItem, userId });
                errorText.textContent = `리뷰 등록 오류: 사용자 인증(userId)이 누락되었습니다. 페이지를 새로고침해주세요.`;
                errorText.classList.remove('hidden');
                return;
            }

            const reviewText = reviewInput.value.trim();
            if (reviewText.length === 0) {
                reviewInput.classList.add('border-red-500', 'animate-shake');
                reviewInput.placeholder = "리뷰 내용을 입력해주세요!";
                setTimeout(() => {
                    reviewInput.classList.remove('border-red-500', 'animate-shake');
                    reviewInput.placeholder = "한 줄 리뷰를 남겨주세요...";
                }, 1000);
                return;
            }

            submitReviewButton.disabled = true;
            submitReviewButton.textContent = "등록중...";
            errorText.classList.add('hidden'); // 이전 오류 숨기기

            try {
                const safeRestaurantName = currentPickedItem.name.replace(/[.\/]/g, '_');
                const collectionPath = `artifacts/${appId}/public/data/lunch-reviews/${safeRestaurantName}/reviews`;
                
                await addDoc(collection(db, collectionPath), {
                    text: reviewText,
                    author: userId, // [FIXED] 이제 userId가 확실히 보장됨
                    timestamp: serverTimestamp() // 서버 시간 기준 타임스탬프
                });

                reviewInput.value = ''; // 입력창 비우기

            } catch (error) {
                console.error("Error adding review: ", error);
                errorText.textContent = `리뷰 등록 오류: ${error.message}`;
                errorText.classList.remove('hidden');
            } finally {
                submitReviewButton.disabled = false;
                submitReviewButton.textContent = "등록";
            }
        }

        // --- 이벤트 리스너 ---
        function setupEventListeners() {
            loadButton.addEventListener('click', loadMenus);
            pickButton.addEventListener('click', pickMenu);

            // Modal functionality
            function openModal(src) {
                if (src && !src.includes('placehold.co') && src.startsWith('http')) { 
                    modalImageContent.src = src;
                    imageModal.classList.remove('hidden');
                    document.body.style.overflow = 'hidden';
                }
            }

            function closeModal() {
                imageModal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                modalImageContent.src = '';
            }

            locationImage.addEventListener('click', () => openModal(locationImage.src));
            menuImage.addEventListener('click', () => openModal(menuImage.src));
            foodImage.addEventListener('click', () => openModal(foodImage.src));

            modalClose.addEventListener('click', closeModal);
            imageModal.addEventListener('click', (e) => {
                if (e.target === imageModal) {
                    closeModal();
                }
            });

            // Review submit listener
            submitReviewButton.addEventListener('click', submitReview);
            reviewInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault(); // Form submit 방지
                    submitReview();
                }
            });
        }

        // --- 페이지 로드 시 실행 ---
        window.addEventListener('DOMContentLoaded', async () => {
            console.log("DOM 로드 완료. 스크립트 실행 시작.");

            // Firebase 초기화 (GitHub Pages용)
            await initializeFirebase();
            
            // 이벤트 리스너 설정
            setupEventListeners();
            
            // 하드코딩된 URL 설정 및 자동 로드
            const hardcodedUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSHqg-V9dLAbA_a30oHi1d7fF6UdyuDnIDu7yrJfC9kXuJnu2ow0ZeuSkdkGeZ1reVi878U27s4Hll3/pub?output=csv";
            sheetUrlInput.value = hardcodedUrl;
            
            // 페이지 로드 시 자동으로 메뉴 불러오기
            if (hardcodedUrl) {
                await loadMenus();
            }
        });

    </script>
</body>
</html>

